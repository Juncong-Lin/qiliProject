<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Upgrading Kit Checkout Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        button { padding: 10px 15px; margin: 5px; }
        .results { margin: 10px 0; padding: 10px; background: #f5f5f5; }
    </style>
</head>
<body>
    <h1>Test Upgrading Kit Checkout Fix</h1>
    
    <div class="test-section">
        <h2>Step 1: Clear Cart</h2>
        <button onclick="clearTestCart()">Clear Cart</button>
        <div id="clear-results" class="results"></div>
    </div>
    
    <div class="test-section">
        <h2>Step 2: Add Upgrading Kit Product to Cart</h2>
        <button onclick="addUpgradingKitToCart()">Add Hoson XP600 Kit</button>
        <div id="add-results" class="results"></div>
    </div>
    
    <div class="test-section">
        <h2>Step 3: Test Checkout Page</h2>
        <button onclick="testCheckoutPage()">Test Checkout</button>
        <div id="checkout-results" class="results"></div>
        <p><a href="checkout.html" target="_blank">Open Checkout Page</a></p>
    </div>
    
    <div class="test-section">
        <h2>Current Cart Contents</h2>
        <button onclick="showCartContents()">Show Cart</button>
        <div id="cart-contents" class="results"></div>
    </div>

    <script type="module">
        import { cart, addToCart, clearCart } from './data/cart.js';
        import { upgradingKitProducts } from './data/upgradingkit-products.js';
        
        // Make functions global for button onclick
        window.clearTestCart = function() {
            try {
                clearCart();
                document.getElementById('clear-results').innerHTML = '<span class="success">✓ Cart cleared successfully</span>';
            } catch (error) {
                document.getElementById('clear-results').innerHTML = '<span class="error">✗ Error clearing cart: ' + error.message + '</span>';
            }
        };
        
        window.addUpgradingKitToCart = function() {
            try {
                // Find a Hoson upgrading kit product
                const hosonProducts = upgradingKitProducts.hoson;
                if (hosonProducts && hosonProducts.length > 0) {
                    const testProduct = hosonProducts[0]; // Get first Hoson product
                    addToCart(testProduct.id, 1);
                    document.getElementById('add-results').innerHTML = 
                        '<span class="success">✓ Added to cart: ' + testProduct.name + '</span><br>' +
                        '<span>Product ID: ' + testProduct.id + '</span>';
                } else {
                    document.getElementById('add-results').innerHTML = '<span class="error">✗ No Hoson products found</span>';
                }
            } catch (error) {
                document.getElementById('add-results').innerHTML = '<span class="error">✗ Error adding to cart: ' + error.message + '</span>';
            }
        };
        
        window.testCheckoutPage = function() {
            try {
                // Import checkout modules to test if they can find the product
                import('./scripts/checkout/orderSummary.js').then(orderModule => {
                    import('./scripts/checkout/paymentSummary.js').then(paymentModule => {
                        if (cart.length > 0) {
                            document.getElementById('checkout-results').innerHTML = 
                                '<span class="success">✓ Checkout modules loaded successfully</span><br>' +
                                '<span>Cart has ' + cart.length + ' item(s)</span><br>' +
                                '<span class="warning">→ Click "Open Checkout Page" to test manually</span>';
                        } else {
                            document.getElementById('checkout-results').innerHTML = 
                                '<span class="warning">⚠ Cart is empty. Add a product first.</span>';
                        }
                    }).catch(error => {
                        document.getElementById('checkout-results').innerHTML = '<span class="error">✗ Error loading payment module: ' + error.message + '</span>';
                    });
                }).catch(error => {
                    document.getElementById('checkout-results').innerHTML = '<span class="error">✗ Error loading order module: ' + error.message + '</span>';
                });
            } catch (error) {
                document.getElementById('checkout-results').innerHTML = '<span class="error">✗ Error testing checkout: ' + error.message + '</span>';
            }
        };
        
        window.showCartContents = function() {
            try {
                if (cart.length === 0) {
                    document.getElementById('cart-contents').innerHTML = '<span class="warning">Cart is empty</span>';
                } else {
                    let html = '<strong>Cart Contents:</strong><br>';
                    cart.forEach((item, index) => {
                        html += `${index + 1}. Product ID: ${item.productId}, Quantity: ${item.quantity}<br>`;
                    });
                    document.getElementById('cart-contents').innerHTML = html;
                }
            } catch (error) {
                document.getElementById('cart-contents').innerHTML = '<span class="error">✗ Error showing cart: ' + error.message + '</span>';
            }
        };
        
        // Show initial cart contents
        window.showCartContents();
    </script>
</body>
</html>
